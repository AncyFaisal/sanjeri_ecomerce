{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Verify Email Change</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted">We've sent a verification OTP to <strong>{{ email }}</strong>. Please enter it below to confirm your email change.</p>
                    
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="otp" class="form-label">Verification OTP</label>
                            <input type="text" class="form-control" id="otp" name="otp" placeholder="Enter 6-digit OTP" required maxlength="6">
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'resend_email_change_otp' %}" class="btn btn-outline-secondary me-md-2">Resend OTP</a>
                            <button type="submit" class="btn btn-primary">Verify Email</button>
                        </div>
                    </form>
                    
                    {% if expiry_time %}
                        <div class="mt-3">
                            <small class="text-muted">OTP expires in <span id="countdown">2:00</span> minutes</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% if expiry_time %}
<script>
    // Countdown timer for OTP expiry
    var countDownDate = new Date({{ expiry_time }} * 1000).getTime();
    
    var x = setInterval(function() {
        var now = new Date().getTime();
        var distance = countDownDate - now;
        
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        document.getElementById("countdown").innerHTML = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
        
        if (distance < 0) {
            clearInterval(x);
            document.getElementById("countdown").innerHTML = "EXPIRED";
        }
    }, 1000);
</script>
{% endif %}
{% endblock %}