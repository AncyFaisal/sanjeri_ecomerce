{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}

<style>
.avatar-img {
    width: 150px !important;
    height: 150px !important;
    max-width: 100%;
    object-fit: cover;
    border-radius: 50%;
}
</style>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <!-- FIXED: Proper if/elif/else structure -->
                    {% if user.profile_image and user.profile_image.url == '/media/profile_images/default_profile.png' %}
                        <img src="{% static 'images/default_profile.png' %}" 
                             alt="Default Profile" 
                             class="avatar-img">
                    {% elif user.profile_image %}
                        <img src="{{ user.profile_image.url }}" 
                             alt="Profile" 
                             class="avatar-img">
                    {% else %}
                        <img src="{% static 'images/default_profile.png' %}" 
                             alt="Default Profile" 
                             class="avatar-img">
                    {% endif %}
                    
                    <!-- Debug info (optional - remove after testing) -->
                    <!-- <div class="mt-2 small text-muted">
                        <small>
                            {% if user.profile_image %}
                                Has profile image
                            {% else %}
                                Using default
                            {% endif %}
                        </small>
                    </div> -->
                </div>
                
                <div class="list-group list-group-flush">
                    <a href="{% url 'user_profile' %}" class="list-group-item list-group-item-action active">Profile</a>
                    <a href="{% url 'user_address_list' %}" class="list-group-item list-group-item-action">Addresses</a>
                    <a href="{% url 'order_list' %}" class="list-group-item list-group-item-action">My Orders</a>
                    <a href="{% url 'change_password' %}" class="list-group-item list-group-item-action">Change Password</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-9">
            <!-- ... rest of your profile content remains exactly the same ... -->
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Profile Information</h4>
                </div>
                <div class="card-body">
                    {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %}
                    {% endif %}

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Full Name:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.get_full_name }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Email:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.email }}
                            <a href="{% url 'change_email' %}" class="btn btn-sm btn-outline-primary ms-2">Change Email</a>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Phone:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.phone|default:"Not provided" }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Gender:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.get_gender_display|default:"Not specified" }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Address:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.address|default:"Not provided"|linebreaks }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-3">
                            <strong>Member Since:</strong>
                        </div>
                        <div class="col-sm-9">
                            {{ user.date_joined|date:"F d, Y" }}
                        </div>
                    </div>

                    <div class="mt-4">
                        <a href="{% url 'edit_profile' %}" class="btn btn-primary">Edit Profile</a>
                        <a href="{% url 'change_password' %}" class="btn btn-outline-secondary">Change Password</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if messages %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(function () {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    });
</script>
{% endif %}
{% endblock %}